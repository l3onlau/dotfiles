#!/bin/bash

# Check if a file was provided as an argument
if [ -z "$1" ]; then
    echo "Usage: $0 <video_file>"
    exit 1
fi

VIDEO_FILE="$1"

# Check if the file exists and is a regular file
if [ ! -f "$VIDEO_FILE" ]; then
    echo "Error: File '$VIDEO_FILE' not found."
    exit 1
fi

# 1. Play the video using mpv
echo "Playing video: $VIDEO_FILE"
mpv --force-window=yes "$VIDEO_FILE"

# $? holds the exit status of the previous command (mpv)
MPV_EXIT_STATUS=$?

if [ $MPV_EXIT_STATUS -eq 0 ]; then
    # 2. Delete the file if mpv exited successfully (status 0)
    echo "mpv finished. Deleting file..."
    rm "$VIDEO_FILE"
    
    # Check if the deletion was successful
    if [ $? -eq 0 ]; then
        echo "Successfully deleted: $VIDEO_FILE"
    else
        echo "Error: Could not delete $VIDEO_FILE"
    fi
else
    # Handle the case where mpv might have been killed or crashed
    echo "mpv exited with status $MPV_EXIT_STATUS. **File not deleted.**"
fi

exit 0
